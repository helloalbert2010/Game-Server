<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸“æ³¨åŠ›è®­ç»ƒå¹³å° - ç™»å½•</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="auth-container">
    <div class="auth-box fade-in">
      <h1 class="auth-title">ğŸ¯ ä¸“æ³¨åŠ›è®­ç»ƒå¹³å°</h1>

      <!-- ç™»å½•è¡¨å• -->
      <div id="login-form">
        <div id="login-alert"></div>

        <div class="form-group">
          <label for="login-username">ç”¨æˆ·å</label>
          <input
            type="text"
            id="login-username"
            class="form-control"
            placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
            autocomplete="username"
          >
        </div>

        <div class="form-group">
          <label for="login-password">å¯†ç </label>
          <input
            type="password"
            id="login-password"
            class="form-control"
            placeholder="è¯·è¾“å…¥å¯†ç "
            autocomplete="current-password"
          >
        </div>

        <button type="button" class="btn btn-primary" style="width: 100%" onclick="handleLogin()">
          ç™»å½•
        </button>

        <div class="auth-switch">
          è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿ <a href="#" onclick="toggleForms()">ç«‹å³æ³¨å†Œ</a>
        </div>
      </div>

      <!-- æ³¨å†Œè¡¨å• -->
      <div id="register-form" class="hidden">
        <div id="register-alert"></div>

        <div class="form-group">
          <label for="register-username">ç”¨æˆ·å</label>
          <input
            type="text"
            id="register-username"
            class="form-control"
            placeholder="è¯·è¾“å…¥ç”¨æˆ·åï¼ˆ3-20ä¸ªå­—ç¬¦ï¼‰"
            autocomplete="username"
          >
        </div>

        <div class="form-group">
          <label for="register-password">å¯†ç </label>
          <input
            type="password"
            id="register-password"
            class="form-control"
            placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä¸ªå­—ç¬¦ï¼‰"
            autocomplete="new-password"
          >
        </div>

        <div class="form-group">
          <label for="register-confirm">ç¡®è®¤å¯†ç </label>
          <input
            type="password"
            id="register-confirm"
            class="form-control"
            placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç "
            autocomplete="new-password"
          >
        </div>

        <button type="button" class="btn btn-primary" style="width: 100%" onclick="handleRegister()">
          æ³¨å†Œ
        </button>

        <div class="auth-switch">
          å·²æœ‰è´¦æˆ·ï¼Ÿ <a href="#" onclick="toggleForms()">ç«‹å³ç™»å½•</a>
        </div>
      </div>
    </div>
  </div>

  <script src="/js/main.js"></script>
  <script>
    // åˆ‡æ¢ç™»å½•/æ³¨å†Œè¡¨å•
    function toggleForms() {
      const loginForm = document.getElementById('login-form');
      const registerForm = document.getElementById('register-form');

      if (loginForm.classList.contains('hidden')) {
        loginForm.classList.remove('hidden');
        registerForm.classList.add('hidden');
      } else {
        loginForm.classList.add('hidden');
        registerForm.classList.remove('hidden');
      }
    }

    // å¤„ç†ç™»å½•
    async function handleLogin() {
      const username = document.getElementById('login-username').value.trim();
      const password = document.getElementById('login-password').value;
      const alertDiv = document.getElementById('login-alert');

      // éªŒè¯è¾“å…¥
      if (!username || !password) {
        showAlert('login-alert', 'è¯·å¡«å†™æ‰€æœ‰å­—æ®µ', 'error');
        return;
      }

      try {
        await login(username, password);
        // ç™»å½•æˆåŠŸï¼Œç­‰å¾…è·³è½¬
        setTimeout(() => {
          window.location.href = '/lobby';
        }, 1000);
      } catch (error) {
        // é”™è¯¯å·²åœ¨ login å‡½æ•°ä¸­å¤„ç†
      }
    }

    // å¤„ç†æ³¨å†Œ
    async function handleRegister() {
      const username = document.getElementById('register-username').value.trim();
      const password = document.getElementById('register-password').value;
      const confirm = document.getElementById('register-confirm').value;

      // éªŒè¯è¾“å…¥
      if (!username || !password || !confirm) {
        showAlert('register-alert', 'è¯·å¡«å†™æ‰€æœ‰å­—æ®µ', 'error');
        return;
      }

      if (username.length < 3 || username.length > 20) {
        showAlert('register-alert', 'ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-20ä¸ªå­—ç¬¦ä¹‹é—´', 'error');
        return;
      }

      if (password.length < 6) {
        showAlert('register-alert', 'å¯†ç é•¿åº¦å¿…é¡»è‡³å°‘6ä¸ªå­—ç¬¦', 'error');
        return;
      }

      if (password !== confirm) {
        showAlert('register-alert', 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´', 'error');
        return;
      }

      try {
        await register(username, password);
        // æ³¨å†ŒæˆåŠŸï¼Œç­‰å¾…è·³è½¬
        setTimeout(() => {
          window.location.href = '/lobby';
        }, 1000);
      } catch (error) {
        // é”™è¯¯å·²åœ¨ register å‡½æ•°ä¸­å¤„ç†
      }
    }

    // æ˜¾ç¤ºæç¤ºä¿¡æ¯
    function showAlert(elementId, message, type) {
      const alertDiv = document.getElementById(elementId);
      alertDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;

      // 3ç§’åè‡ªåŠ¨éšè—
      setTimeout(() => {
        alertDiv.innerHTML = '';
      }, 3000);
    }

    // å›è½¦é”®æäº¤
    document.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        const loginForm = document.getElementById('login-form');
        if (!loginForm.classList.contains('hidden')) {
          handleLogin();
        } else {
          handleRegister();
        }
      }
    });
  </script>
</body>
</html>
